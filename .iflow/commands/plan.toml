# Command: plan
# Description: Generate development plan using architectural design analysis
# Category: planning
# Version: 1
# Author: iFlow

description = "使用架构分析团队生成开发计划"

prompt = """
请使用 architectural_design_analysis agent 分析任务并生成开发计划。

任务文件：{{args}}

请按照以下步骤执行：

1. **读取任务文件**：
   - 读取 {{args}} 文件
   - 理解任务需求和背景

2. **检查现有 plans**：
   - 列出 .iflow/plans/ 目录下的所有计划
   - 检查是否有类似计划
   - 如果有多个类似计划，询问用户是否要合并，还是单独生成新的计划

3. **团队多维度分析**：
   - 架构师视角：架构影响分析、设计模式建议
   - 性能专家视角：性能影响评估、优化建议
   - 安全专家视角：安全风险评估、防护措施
   - 系统分析师视角：调用链路分析、数据流分析

4. **生成技术方案**：
   - 整体方案设计
   - 关键技术点
   - 实现策略

5. **任务分解**：
   - 按阶段划分任务
   - 每个任务必须包含具体的文件路径
   - 标明优先级（high/medium/low）

6. **创建 todo 列表**：
   - 使用 todo_write 工具创建可执行的 todo 列表
   - 每个 todo 必须包含：id、task（具体描述+文件路径）、status（pending）、priority

7. **写入计划文件**：
   - 将计划写入 .iflow/plans/ 目录
   - 计划必须包含：任务背景、团队分析、技术方案、任务分解、todo 列表、风险评估、验证标准

输出格式参考：
```markdown
# {任务名称} 开发计划

## 1. 任务背景
- 任务描述
- 当前问题
- 目标和期望

## 2. 团队分析
### 架构师视角
- 架构影响分析
- 设计模式建议

### 性能专家视角
- 性能影响评估
- 优化建议

### 安全专家视角
- 安全风险评估
- 防护措施

### 系统分析师视角
- 调用链路分析
- 数据流分析

## 3. 技术方案
- 整体方案设计
- 关键技术点
- 实现策略

## 4. 任务分解
### 阶段1：{阶段名称}
- 任务1.1：{具体描述} - {文件路径}
- 任务1.2：{具体描述} - {文件路径}

### 阶段2：{阶段名称}
- 任务2.1：{具体描述} - {文件路径}
- 任务2.2：{具体描述} - {文件路径}

## 5. Todo 列表

以下任务已添加到 todo 列表，使用 $todo_read 查看：

- [ ] 任务1：{具体描述} - {文件路径} (high)
- [ ] 任务2：{具体描述} - {文件路径} (medium)
- [ ] 任务3：{具体描述} - {文件路径} (low)

## 6. 实施步骤
1. 步骤1：{描述}
2. 步骤2：{描述}
3. ...

## 7. 风险评估
- 风险1：{描述} - 应对措施
- 风险2：{描述} - 应对措施

## 8. 验证标准
- 验证标准1：{描述}
- 验证标准2：{描述}

## 9. 注意事项
- 注意事项1
- 注意事项2
```
"""
